<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <title>Friend Finder Survey</title>
</head>
<body>

<div class="container">

    <div class="row">

        <div class="col-sm-12 mt-5 mr-auto ml-auto mb-5 pb-5">

            <h2 class="mr-auto ml-auto text-center">Please fill out this survey in order to be matched with someone of similar music tastes</h2>
            <h4 class="mr-auto ml-auto text-center">(1=Strongly Disagree || 2=Somewhat Disagree || 3=Indifferent || 4=Agree || 5=Strongly Agree)</h4>


        <form class="col-sm-10 mt-5 mr-auto ml-auto">
            <div class="form-group">
                <label for="username">What is your name?</label>
                <input type="text" class="form-control" id="username" placeholder="John Doe">
            </div>
            <div class="form-group">
                <label for="imageurl">Image URL: (required)</label>
                <textarea class="form-control" id="imageurl" rows="2" placeholder="http://www...."></textarea>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question1">I can have been known to say things like "they don't make music like they did in the 70s anymore"</label>
                <select class="form-control" id="question1">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question2">Jimmy Buffet is one of the greatest songwriters of all time</label>
                <select class="form-control" id="question2">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question3">I find myself listening to electronic music more and more these days</label>
                <select class="form-control" id="question3">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question4">I would much prefer an intimate concert venue with a local artist than a mega-stacium and a huge pop star</label>
                <select class="form-control" id="question4">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question5">I can name more than 5 classical composrs</label>
                <select class="form-control" id="question5">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question6">I prefer Rap and/or Hip-Hop over Classic Rock</label>
                <select class="form-control" id="question6">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question7">I prefer Reagae over Jazz</label>
                <select class="form-control" id="question7">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question8">I love going to concerts and feel like you can't really truely appreciate an atrist until you've heard them live</label>
                <select class="form-control" id="question8">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                <label for="question9">I prefer Spotify to Apple Music</label>
                <select class="form-control" id="question9">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group mt-5 mb-5">
                    <label for="question10">The Beatles did more for Rock and Roll music than The Rolling Stones did</label>
                    <select class="form-control" id="question10">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                    </select>
                </div>


            <button class="btn btn-success btn-lg mb-5" id="comparescores"><span class="fa fa-eye"></span> Find your iHarmony Match!</button>
            <button class="btn btn-secondary btn-sm mb-5" id="submitdata"><span class="fa fa-eye"></span> Put Yourself in the Database</button>
            <button class="btn btn-secondary btn-sm mb-5" id="seedatabase"><span class="fa fa-eye"></span> See Database</button>
            <button class="btn btn-secondary btn-sm mb-5" id="cleardata"><span class="fa fa-eye"></span> Reset Database</button>


            <br>

            <div id="dumpsite"></div>

        </form>

        </div>

    </div>



    

        <script type="text/javascript">

            $("#submitdata").on("click", function(instance) {
                instance.preventDefault();
                storeData();
            });

            $("#seedatabase").on("click", function(instance) {
                instance.preventDefault();
                 seeDB();
            });

            $("#comparescores").on("click", function(instance) {
                instance.preventDefault();
                compareDB();
            });

            $("#cleardata").on("click", function(instance) {
                $.post("/survey/clear")
            });



            
            function storeData(event) {

                console.log($("#question2").val());


                var newPerson = {
                name: $("#username").val().trim(),
                image: $("#imageurl").val().trim(),
                scores: [
                    parseFloat($("#question1").val()),
                    parseFloat($("#question2").val()),
                    parseFloat($("#question3").val()),
                    parseFloat($("#question4").val()),
                    parseFloat($("#question5").val()),
                    parseFloat($("#question6").val()),
                    parseFloat($("#question7").val()),
                    parseFloat($("#question8").val()),
                    parseFloat($("#question9").val()),
                    parseFloat($("#question10").val())
                ]
                    };
                
                $.post("/survey/add", newPerson)
                .then(function(data) {
                console.log("data/friends.js", data);
                alert("Successfully placed into the iHarmony Database!!");
                });
            };

            function seeDB(event) {
                $("#dumpsite").empty();
                $.get("/survey/people", function (data) {
                    console.log(data);
                    if (data) {
                        for (i=0; i<data.length; i++) {
                            
                            var newrow = $("<div>").addClass("container");
            
                            (newrow).html('<div class="row mb-2 mt-5 shadow-lg p-3 mb-5 rounded divColor"><div class="col-sm-6"><img src="' + (data[i].image) + '" class="img-fluid"></div><div class="col-sm-2></div><div class="col-sm-4"><h4>Name:<br> ' + data[i].name + '</h4></div></div>')
                                
                            $("#dumpsite").prepend(newrow);

                        };
                    } if (data.length === 0) {
                        var newrow = $("<div>").addClass("container");
            
                        (newrow).html('<div class="row mb-3 shadow-lg p-3 mb-5 rounded divColor"><div class="col-sm-7"><img src="https://cdn.pixabay.com/photo/2016/04/24/13/24/error-1349562__340.png" class="img-fluid"></div><div class="col-sm-1></div><div class="col-sm-4"><h4>Database has been wiped or cannot be found.</h4></div></div>')
                
                        $("#dumpsite").prepend(newrow);
                        }
                });

               
            };


            function compareDB() {
                var newScores = {
                name: $("#username").val().trim(),
                image: $("#imageurl").val().trim(),
                scores: [
                    parseFloat($("#question1").val()),
                    parseFloat($("#question2").val()),
                    parseFloat($("#question3").val()),
                    parseFloat($("#question4").val()),
                    parseFloat($("#question5").val()),
                    parseFloat($("#question6").val()),
                    parseFloat($("#question7").val()),
                    parseFloat($("#question8").val()),
                    parseFloat($("#question9").val()),
                    parseFloat($("#question10").val())
                    ]
                };

                $.get('/survey/people', function(data) {
                    var match;
                    let difference = 50;

                    for (i=0; i<data.length; i++) {
                        var newDiff = 0;
                        for (k=0; k<10; k++) {
                            newDiff = newDiff + Math.abs((data[i].scores[k] - newScores.scores[k])) ;
                            }
                            if (newDiff < difference) {
                                difference = newDiff;
                                match = data[i];
                        };
                        console.log("newDiff" + newDiff);
                        console.log("difference" + difference)
                    };
                    console.log(match);
                    console.log(match.name);


            var matchDivUser = $("<div>").addClass("container");
            
            // (matchDivUser).html('<div class="row mb-2 mt-5 shadow-lg p-3 mb-5 rounded divColor"><div class="col-sm-6"><img src="' + (newScores.image) + '" class="img-fluid"></div><div class="col-sm-2></div><div class="col-sm-4"><h4>Name:<br> ' + newScores.name + '</h4></div></div>')
                (matchDivUser).html(`<div class="row mb-2 mt-5 shadow-lg p-3 mb-5 rounded divColor">
                
                    <div class="col-sm-4">
                        <h2> You: </h2>
                        <img src="${newScores.image}" class="img-fluid">
                    </div>
                    

                    <div class="col-sm-3" ml-auto mr-auto>
                        <h2> Have <br> Matched <br> With...</h2>
                    </div>
                    
                    
                    <div class="col-sm-4">
                        <h2> ${match.name} </h2>
                        <img src="${match.image}" class="img-fluid">

                    </div>
                
                </div>`)

            $("#dumpsite").prepend(matchDivUser);
            

                });


            };

        </script>
</body>
</html>